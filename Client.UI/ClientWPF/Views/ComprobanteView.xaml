<Window x:Class="ClientWPF.Views.ComprobanteView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Comprobantes Contables" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        MouseDown="Window_MouseDown">

    <Window.Resources>
        <Color x:Key="BaseColor">#EBECF0</Color>
        <SolidColorBrush x:Key="BaseBrush" Color="{StaticResource BaseColor}"/>
        <SolidColorBrush x:Key="TextBrush" Color="#5A667F"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#4D7CFE"/>
        <SolidColorBrush x:Key="DangerBrush" Color="#FF6B6B"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#51CF66"/>

        <Style x:Key="NeuInputStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="{StaticResource BaseBrush}"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#FFFFFF" Direction="135" ShadowDepth="2" BlurRadius="2" Opacity="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="#D1D9E6"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="NeuIconButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource BaseBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <Border x:Name="shadow" CornerRadius="10" Background="{StaticResource BaseBrush}">
                                <Border.Effect>
                                    <DropShadowEffect Color="#A6ABBD" Direction="315" ShadowDepth="3" BlurRadius="6" Opacity="0.5"/>
                                </Border.Effect>
                            </Border>
                            <Border x:Name="border" CornerRadius="10" Background="{TemplateBinding Background}" BorderThickness="0">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,5"/>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95" CenterX="20" CenterY="15"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="Padding" Value="10,10"/>
                    </Style>
                </Setter.Value>
            </Setter>
            <Setter Property="CellStyle">
                <Setter.Value>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Padding" Value="10"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridCell">
                                    <Border BorderThickness="0,0,0,1" BorderBrush="#D1D9E6" Background="Transparent">
                                        <ContentPresenter VerticalAlignment="Center" />
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Background" Value="Transparent"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Background="{StaticResource BaseBrush}" CornerRadius="20" Padding="20">
        <Border.Effect>
            <DropShadowEffect Color="#000000" BlurRadius="20" ShadowDepth="0" Opacity="0.2"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- HEADER -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="📝" FontSize="25" Margin="0,0,10,0"/>
                    <TextBlock Text="COMPROBANTES CONTABLES" FontSize="22" FontWeight="Bold" Foreground="{StaticResource TextBrush}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Style="{StaticResource NeuIconButton}" Click="BtnRecargar_Click" ToolTip="Recargar" Margin="0,0,10,0" Width="40" Height="40">
                        <Path Data="M2 12C2 16.97 6.03 21 11 21C13.39 21 15.68 20.06 17.4 18.4L15.9 16.9C14.63 18.25 12.86 19 11 19C4.76 19 1.64 11.46 6.05 7.05C10.46 2.64 18 5.77 18 12H15L19 16L23 12H20C20 7.03 15.97 3 11 3C6.03 3 2 7.03 2 12Z" 
                              Fill="{StaticResource TextBrush}" Stretch="Uniform" Width="18" Height="18"/>
                    </Button>

                    <Button Style="{StaticResource NeuIconButton}" Click="BtnCerrar_Click" ToolTip="Cerrar" Width="40" Height="40">
                        <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
                              Fill="{StaticResource DangerBrush}" Stretch="Uniform" Width="15" Height="15"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- CONTENIDO -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="400"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- PANEL IZQUIERDO: LISTA DE COMPROBANTES -->
                <Border Grid.Column="0" Background="{StaticResource BaseBrush}" CornerRadius="15" Margin="0,0,15,0" Padding="15">
                    <Border.Effect>
                        <DropShadowEffect Color="#A6ABBD" Direction="315" ShadowDepth="5" BlurRadius="10" Opacity="0.3"/>
                    </Border.Effect>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Lista de Comprobantes" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,0,0,15"/>

                        <DataGrid Grid.Row="1" x:Name="gridComprobantes" SelectionChanged="GridComprobantes_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Número" Binding="{Binding Numero}" Width="80"/>
                                <DataGridTextColumn Header="Fecha" Binding="{Binding Fecha, StringFormat=dd/MM/yyyy}" Width="100"/>
                                <DataGridTextColumn Header="Observaciones" Binding="{Binding Observaciones}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>

                <!-- PANEL DERECHO: FORMULARIO CABECERA + DETALLE -->
                <Border Grid.Column="1" Background="{StaticResource BaseBrush}" CornerRadius="15" Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="#A6ABBD" Direction="315" ShadowDepth="5" BlurRadius="10" Opacity="0.3"/>
                    </Border.Effect>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- CABECERA DEL COMPROBANTE -->
                        <StackPanel Grid.Row="0">
                            <TextBlock Text="Datos de Cabecera" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,0,0,15"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="15"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Número" Foreground="{StaticResource TextBrush}" FontWeight="Bold" Margin="5,0,0,5"/>
                                    <Border Style="{StaticResource NeuInputStyle}">
                                        <TextBox x:Name="txtNumero" Background="Transparent" BorderThickness="0" VerticalContentAlignment="Center" Padding="10,0" FontSize="14"/>
                                    </Border>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Fecha" Foreground="{StaticResource TextBrush}" FontWeight="Bold" Margin="5,0,0,5"/>
                                    <Border Style="{StaticResource NeuInputStyle}">
                                        <DatePicker x:Name="dpFecha" Background="Transparent" BorderThickness="0" VerticalContentAlignment="Center" Padding="10,0" FontSize="14"/>
                                    </Border>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="Observaciones" Foreground="{StaticResource TextBrush}" FontWeight="Bold" Margin="5,0,0,5"/>
                            <Border Style="{StaticResource NeuInputStyle}" Height="60">
                                <TextBox x:Name="txtObservaciones" Background="Transparent" BorderThickness="0" VerticalContentAlignment="Top" Padding="10" FontSize="14" TextWrapping="Wrap" AcceptsReturn="True"/>
                            </Border>
                        </StackPanel>

                        <!-- DETALLE: AGREGAR LÍNEA -->
                        <Border Grid.Row="1" Background="#F5F7FA" CornerRadius="10" Padding="15" Margin="0,15,0,15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="80"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Cuenta" Foreground="{StaticResource TextBrush}" FontWeight="Bold" FontSize="11" Margin="0,0,0,5"/>
                                    <ComboBox x:Name="cboCuenta" Height="35" DisplayMemberPath="Nombre" SelectedValuePath="CuentaId" FontSize="13"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Debe" Foreground="{StaticResource TextBrush}" FontWeight="Bold" FontSize="11" Margin="0,0,0,5"/>
                                    <TextBox x:Name="txtDebe" Height="35" VerticalContentAlignment="Center" Padding="8,0" FontSize="13" Text="0"/>
                                </StackPanel>

                                <StackPanel Grid.Column="4">
                                    <TextBlock Text="Haber" Foreground="{StaticResource TextBrush}" FontWeight="Bold" FontSize="11" Margin="0,0,0,5"/>
                                    <TextBox x:Name="txtHaber" Height="35" VerticalContentAlignment="Center" Padding="8,0" FontSize="13" Text="0"/>
                                </StackPanel>

                                <Button Grid.Column="6" Content="+" Click="BtnAgregarDetalle_Click" 
                                        Background="{StaticResource SuccessBrush}" Foreground="White" 
                                        BorderThickness="0" Height="35" VerticalAlignment="Bottom" 
                                        FontWeight="Bold" FontSize="18" Cursor="Hand" ToolTip="Agregar Línea"/>
                            </Grid>
                        </Border>

                        <!-- GRID DETALLE -->
                        <DataGrid Grid.Row="2" x:Name="gridDetalle">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Código" Binding="{Binding CodigoCuenta}" Width="100"/>
                                <DataGridTextColumn Header="Cuenta" Binding="{Binding NombreCuenta}" Width="*"/>
                                <DataGridTextColumn Header="Debe" Binding="{Binding CantidadDebe, StringFormat=N2}" Width="100"/>
                                <DataGridTextColumn Header="Haber" Binding="{Binding CantidadHaber, StringFormat=N2}" Width="100"/>

                                <DataGridTemplateColumn Header="Acc" Width="60">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Click="BtnEliminarDetalle_Click" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Eliminar">
                                                <Path Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" 
                                                      Fill="{StaticResource DangerBrush}" Width="14" Height="14" Stretch="Uniform"/>
                                            </Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- TOTALES Y BOTONES -->
                        <Grid Grid.Row="3" Margin="0,15,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="200"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Total Debe: " FontWeight="Bold" Foreground="{StaticResource TextBrush}"/>
                                <TextBlock x:Name="txtTotalDebe" Text="0.00" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" Margin="5,0,20,0"/>

                                <TextBlock Text="Total Haber: " FontWeight="Bold" Foreground="{StaticResource TextBrush}"/>
                                <TextBlock x:Name="txtTotalHaber" Text="0.00" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" Margin="5,0,20,0"/>

                                <TextBlock x:Name="txtEstadoCuadre" Text="⚠ Descuadrado" FontWeight="Bold" Foreground="{StaticResource DangerBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="Nuevo" Click="BtnNuevo_Click" Style="{StaticResource NeuIconButton}" Width="90" Height="40" Margin="0,0,10,0"/>
                                <Button Content="Guardar" Click="BtnGuardar_Click" Style="{StaticResource NeuIconButton}" Width="90" Height="40" Foreground="{StaticResource AccentBrush}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>